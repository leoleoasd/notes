\documentclass{ctexart}
\usepackage[T1]{fontenc}
\usepackage[a4paper,top=1.5cm,bottom=1.5cm,left=2cm,right=2cm,marginparwidth=1.75cm]{geometry}
\usepackage{mathtools}
\usepackage{tikz}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{outlines}
\usepackage{graphicx}
\usepackage{amsthm}
\usepackage{minted}
\usepackage{environ}
\usepackage{fancyvrb}
\usepackage[colorlinks=false, allcolors=blue]{hyperref}

\definecolor{bg}{rgb}{0.95,0.95,0.95}
\renewcommand{\tableautorefname}{表}
\DeclarePairedDelimiter{\set}{\{}{\}}
\DeclarePairedDelimiter{\paren}{(}{)}
\graphicspath{ {./images/} }

\title{标题}
\author{卢雨轩 19071125}
% \date{\today}
\ctexset{
    section = {
        titleformat = \raggedright,
        name = {,},
        number = \chinese{section}、
    },
    paragraph = {
        runin = false
    },
    today = small,
    figurename = 图,
    contentsname = 目录,
    tablename = 表,
}
\newwrite\tempfile

% \NewEnviron{run}{
% \immediate\openout\tempfile=temp.sql
% \immediate\write\tempfile{\BODY}
% \immediate\closeout\tempfile
    % \BODY
    % \BODY
% }
% \newenvironment{}{}{}
% \newenvironment{run}{\begin{run_inner}}{\end{run_inner}}
\makeatletter
\def\run{\FV@Environment{}{run}}
\def\FVB@run{%
  \@bsphack
  \begingroup
    \FV@UseKeyValues
    \FV@DefineWhiteSpace
    \def\FV@Space{\space}%
    \FV@DefineTabOut
    \def\FV@ProcessLine{\immediate\write\FV@OutFile}%
    \immediate\openout\FV@OutFile temp.sql\relax
    \let\FV@FontScanPrep\relax
%% DG/SR modification begin - May. 18, 1998 (to avoid problems with ligatures)
    \let\@noligs\relax
%% DG/SR modification end
    \FV@Scan}
\def\FVE@run{\immediate\closeout\FV@OutFile\endgroup\@esphack
    \noindent\fbox{%
        \parbox{\textwidth}{%
            \noindent 代码：%
            \inputminted[bgcolor=bg]{sql}{temp.sql}%
            \noindent 执行结果：%
            \immediate\write18{rm temp.result}%
            \immediate\write18{bash -c "$(cat test.env | sed 's/#.*//g' | xargs) psql -f temp.sql > temp.result 2>&1 $()"}% 
            % empty $() here fixes latex workshop's code highlight.
            % else there will be a single $, which will cause wrong highlight on whole tex file.
            \inputminted[bgcolor=bg,breaklines=true]{text}{temp.result}%
        }%
    }
}
\DefineVerbatimEnvironment{run}{run}{}
\makeatother
% \immediate\write18{export }
\begin{document}

\maketitle

\begin{run}
create database test;
\end{run}

\begin{run}
select 1;
\end{run}
    

% \begin{run}
%     123_233
% \end{run}

% \immediate\write18{psql -h 10.0.0.14 -U leo eduoj -c 'drop database test' >> a 2>&1}

% \run{drop database test;}
% \run{create database test;}
% \run{select 1;}

\end{document}
